# PostGreSQL

## Planning Journée

```
Correction Challenge 1h30 / 2h
- Requêtes SQL
- Refactor :
  - PG_URL -> .env
  - /promos
  - /promo/:id
  - /promo/:id/students
  - Promesses : `.then()` / `.catch()`

- PostGreSql 2h: config de sa propre BDD Trombi
    - Installation:

### Après midi

- Création de la BDD trombi avec Import du fichier

- SQL CRUD 1h (Create, Read, Update, Delete) sur la database Trombi:
    - INSERT
    - UPDATE
     -DELETE
```

## Note Correction

[Aide promesse](https://kourou.oclock.io/ressources/objectifs/manipuler-un-resultat-envoye-sous-forme-de-promesse/)

### Promesses

```js
db.query('SELECT * FROM "promo" ORDER BY name ASC') // Promesse = un objet dont le resultat arrivera "plus tard"
  .then((result) => {
    console.log(result);
  }) // Si la promesse reussit !
  .catch((error) => {
    console.error(error);
  }); // Si la promesse échoue
```

## Postgres en local

on a réussi à se connecter à une base de donnée distante, on peut recup de la donnée mais on ne peut modifier ou supprimer une donnée

donc on va devoir la créer nous meme

Se connecter à Postgres **AVEC LA VM** :

- ✅ `sudo -i -u postgres psql`
- Mdp de votre VM, NiceDCV

Se connecter à Postgres **AVEC MACOS* :

`postgres -V`
`psql postgres`

Se connecter à Postgres **SANS VM, sur window** :

- ✅ `psql -U postgres -d postgres -h localhost`
- ou plus `psql -U postgres -d postgres`
- `psql -U postgres` 
- mdp est celui que vous avez défini lors de l'installation de postgres

```
postgres=#
```

`postgres` est l'utilisateur (role) par défaut lors de son installation. C'est un `super user`, il a tous les droits (privilège)
On évitera de travailler avec cet utilisateur sur notre BDD, car il peut tout faire et notamment supprimer
**il faut donc créer une DB avec un utilisateur propre à la DB créé**

On utilise le role postgres que pour créer un nouvelle utilisateur et créer la DB associé

### Objectifs

- ✅ créer un utilisateur (role) `trombi`
- ✅ créer une DB: `trombi`
- dans cette DB, on va créer une table promo et student
- ajouter des données dans ces 2 tables

## Creation d'un utilisateur et d'une BDD

[la doc](https://kourou.oclock.io/ressources/objectifs/creer-une-nouvelle-base-de-donnee-sur-postgresql/)

Créer un utilisateur :

- ✅ `CREATE ROLE trombi WITH LOGIN PASSWORD 'trombi';`
- `\du` -> pour vérifier !

Créer la base de données :

- ✅ `CREATE DATABASE trombi WITH OWNER trombi;`
- `\l` -> pour vérfier !


- `\conninfo` : donne des info sur la connexion actuelle

- ✅ `\c trombi trombi` : pour se connecter à la base `trombi` (base en premier) en tant qu'utilisateur `trombi` (user en premier)
  - si on demande le MDP, c'est celui qu'on a choisit pour l'utilisateur aux étapes précédentes

#### Pour se connecter directement dans le bash

- ✅ `psql -U trombi -d trombi`
- Alternativement : `psql -U trombi -d trombi -h localhost` (astuce si `Peer authentication failed`)


### Supprimer un utilisateur ou une BDD

- `DROP DATABASE <nom_base>;`
- `DROP ROLE <nom_user>;`